&НаКлиенте
Процедура ПересчетТЧ(Элемент)
    // Правильно передаем текущую строку табличной части
    РаботаСДокументами.РассчитатьСумму(Элементы.ТабНоменклатура.ТекущиеДанные);
КонецПроцедуры

&НаКлиенте
Процедура ТабНоменклатураПриИзменении(Элемент)
    // Пересчитываем итоговую сумму
    Объект.СуммаИтого = Объект.ТабНоменклатура.Итог("Сумма");
    
    // Получаем сумму прописью и присваиваем реквизиту формы
    Объект.СуммаИтогоПрописью = РаботаСДокументами.ИтоговоеЧислоПрописью(Объект.СуммаИтого);
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
    // Инициализируем при открытии формы
    Объект.СуммаИтого = Объект.ТабНоменклатура.Итог("Сумма");
    Объект.СуммаИтогоПрописью = РаботаСДокументами.ИтоговоеЧислоПрописью(Объект.СуммаИтого);
КонецПроцедуры

&НаКлиенте
Процедура КонтрагентПриИзменении(Элемент)
    // Проверяем, является ли выбранный контрагент поставщиком
    Если НЕ ПроверкаКонтрагента(Объект.Контрагент) Тогда
        ТекстСообщения = "Выбранный контрагент не является поставщиком!
        |Очистить поле Контрагент?";
        Режим = РежимДиалогаВопрос.ДаНет;
        Оповещение = Новый ОписаниеОповещения("ПослеЗакрытияВопроса", ЭтотОбъект);
        ПоказатьВопрос(Оповещение, ТекстСообщения, Режим);
    КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ПослеЗакрытияВопроса(Результат, Параметры) Экспорт
    // Обрабатываем ответ пользователя на вопрос об очистке контрагента
    Если Результат = КодВозвратаДиалога.Да Тогда
        Объект.Контрагент = Неопределено;
    КонецЕсли;
КонецПроцедуры

&НаСервере
Функция ПроверкаКонтрагента(ВыбКонтрагент)
    // Проверяем, что контрагент выбран и является поставщиком     
	
    // Если контрагент не выбран - сразу возвращаем Ложь
    Если ВыбКонтрагент = Неопределено Тогда
        Возврат Ложь;
    КонецЕсли;

	// Проверяем свойство контрагента "ЭтоПоставщик"
    Возврат ВыбКонтрагент.ЭтоПоставщик;
КонецФункции